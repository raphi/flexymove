<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" 
		 xmlns:esri="http://www.esri.com/2008/ags"
		 creationComplete="init()"
		 initialize="application_initializeHandler(event)"
		 width="100%" height="100%">

	<fx:Metadata>
		[Event("change", type="mx.events.Event")]
	</fx:Metadata>
	
	<s:layout>
		<s:VerticalLayout horizontalAlign="center" paddingTop="3"/>
	</s:layout>
	
	<fx:Script>
		<![CDATA[
			import com.esri.ags.Graphic;
			import com.esri.ags.events.IdentifyEvent;
			import com.esri.ags.events.MapMouseEvent;
			import com.esri.ags.geometry.MapPoint;
			import com.esri.ags.skins.supportClasses.AttachmentMouseEvent;
			import com.esri.ags.symbols.CompositeSymbol;
			import com.esri.ags.tasks.supportClasses.IdentifyResult;
			import com.esri.ags.utils.WebMercatorUtil;
			import com.esri.ags.tasks.GeometryService;
			
			import flashx.textLayout.formats.Float;
			
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.rpc.events.FaultEvent;
			
			[Bindable]
			public var curent_pos_x : int = 0;
			[Bindable]
			public var curent_pos_y : int = 0;
			
			public var inputPoints:Array = [];
			[Bindable]
			public var ValZoomChangeMap:int = 6;
			
			private function init() :void
			{
				myMap.logoVisible = false;

			}
			protected function application_initializeHandler(event:FlexEvent):void
			{
				//myEditor.featureLayers = [ points, fireAreas ];
			}
			private function onMapClick(event:MapMouseEvent):void
			{
				const pt:MapPoint = event.mapPoint;
				var latlong:MapPoint = WebMercatorUtil.webMercatorToGeographic(event.mapPoint) as MapPoint;
				inputPoints.push(pt);
				
				myGraphicsLayer.add(new Graphic(pt, new CompositeSymbol([sms,startText,att]))); //possibilitÃ© de mettre plusieur composite
				curent_pos_x = parseFloat(latlong.x.toFixed(6));
				curent_pos_y = parseFloat(latlong.y.toFixed(6));
				
				textArea.htmlText += "location [" + inputPoints.length + "] : " +latlong.y.toFixed(6)+" "+latlong.x.toFixed(6) + " "+ 
					"Zom = " + myMap.level+"<br />";
				
				myMap.infoWindow.label = "You clicked at "
				+ event.mapPoint.x.toFixed(1) + " / " + event.mapPoint.y.toFixed(1)
				+ "\nLat/Long is: " + latlong.y.toFixed(6)
				+ " / " + latlong.x.toFixed(6);
				myMap.infoWindow.show(event.mapPoint); // "Show the click"
				
			}
			
			protected function clear_clickHandler(event:MouseEvent):void
			{
				refresh();
			}
			
			private function refresh():void
			{
				myGraphicsLayer.clear();
				inputPoints = [];
				textArea.htmlText = "";
			}
			
		]]>
	</fx:Script>
	<fx:Declarations>
		
		<esri:SimpleMarkerSymbol id="sms"
								 alpha="0.65"
								 color="0xffff00"
								 size="12"
								 style="x"
								 >
			<esri:SimpleLineSymbol width="2"
								   color="0xFF0000"
								   style="solid"/>
		</esri:SimpleMarkerSymbol>
		
		
		<esri:InfoSymbol id="info"> 
			<esri:infoRenderer>
				<fx:Component> 
					<mx:VBox>  
						<mx:Image width="100%" height="100%" source="C:\Users\Nicolas\Desktop\row.png"/>  
						<mx:Label text="hello"/>  
					</mx:VBox> 
				</fx:Component>
			</esri:infoRenderer>
		</esri:InfoSymbol>

		<esri:InfoSymbol id="VideoOnMap">
			<esri:infoRenderer>
				<fx:Component>
					<s:Button label="video"/>
				</fx:Component>
			</esri:infoRenderer>
		</esri:InfoSymbol>

		<esri:TextSymbol id="startText"
						 color="0x0000FF"
						 text="Your Video"
						 yoffset="14"/>

		<esri:Graphic id="VideoOnMap2">
			<esri:geometry>
				<esri:MapPoint x="{curent_pos_x}" y="{curent_pos_y}"/>
			</esri:geometry>
			<esri:symbol>
				<esri:InfoSymbol >
					<esri:infoRenderer>
						<fx:Component>
							<s:Button label="yourVideo"/>
						</fx:Component>
					</esri:infoRenderer>
				</esri:InfoSymbol>
			</esri:symbol>
		</esri:Graphic>
		
		
		
		<esri:Graphic id="att" >
			<esri:attributes>
				<fx:Object>
					<fx:theName>Jomo Kenyatta Airport</fx:theName>
					<fx:thePlaceName>Nairobi, Kenya</fx:thePlaceName>
				</fx:Object>
			</esri:attributes>
		</esri:Graphic>
		
	</fx:Declarations>
	
	
	<s:HGroup width="100%" height="100%"
			  left="5" top="5">
		<s:VGroup height="100%">
			<mx:Spacer width="100%"/>
			<s:Button id="clearRouteButton"
					  click="clear_clickHandler(event)"
					  label="Clear Selected"/>
			<mx:Spacer width="100%"/>
			<mx:HRule width="100%"/>
			<mx:TextArea id="textArea"
						 width="300" height="100%"
						 horizontalScrollPolicy="auto"
						 verticalScrollPolicy="auto"/>
		</s:VGroup>
		<!--<esri:Editor id="myEditor"
					 geometryService="{new GeometryService('http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer')}"
					 map="{myMap}"
					 toolbarVisible="true"/>-->
		<s:Panel width="100%" height="100%"
				 dropShadowVisible="false"
				 title="Click on the map to mark a location">
			<esri:Map id="myMap"
					  width="100%" height="100%"
					  mapClick="onMapClick(event)"
					  openHandCursorVisible="true" >
				<esri:extent>
					<esri:Extent xmin="-13917000" ymin="1625000" xmax="-8907000" ymax="8278291">
						<esri:SpatialReference wkid="102100"/>
					</esri:Extent>
				</esri:extent>
				<esri:ArcGISTiledMapServiceLayer id="world_imagery" url="http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer" visible="{!(myMap.level > ValZoomChangeMap)}"/>
				<esri:ArcGISTiledMapServiceLayer url="http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer" visible="{!world_imagery.visible}"/>
				<esri:GraphicsLayer id="myGraphicsLayer"/>
			<!--	<esri:FeatureLayer id="points"
								   mode="snapshot"
								   outFields="*"
								   url="http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Fire/Sheep/FeatureServer/0"/>
				<esri:FeatureLayer id="fireAreas"
								   mode="snapshot"
								   outFields="*"
								   url="http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Fire/Sheep/FeatureServer/2"/>-->
			
			</esri:Map>

			
		</s:Panel>
	</s:HGroup>
	<s:Button label="View Profile" click="dispatchEvent( new Event( Event.CHANGE ) );" />
	
</s:Group>
<!--bb.selectedIndex == 0-->