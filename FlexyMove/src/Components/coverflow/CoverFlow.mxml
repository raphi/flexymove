<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 xmlns:coverflow="Components.coverflow.*"
		 width="100%" height="100%">
	
	<fx:Metadata>
		[Event("change", type="mx.events.Event")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import Components.PopUpPlayer.PopUpPlayer;
			import Components.coverflow.itemsRenderers.MyFolderRenderer;
			import Components.coverflow.itemsRenderers.MyMovieRenderer;
			import Components.coverflow.itemsRenderers.PodRenderer;
			
			import com.flexymove.Managers.MarkerManager;
			import com.flexymove.VO.VideoInfoVO;
			
			import mx.collections.ArrayList;
			import mx.managers.PopUpManager;
			public const HORIZONTALDISTANCE:Number = 81;		// 0 TO 200
			public const SELECTEDITEMPROXIMITY:Number = 30;		// 0 TO 200	
			public const DEPTHDISTANCE:Number = 68; 			// 1 TO 200
			public const ELEMENTROTATION:Number = -45; 			// -90 TO 0 -35
			public const FOCALLENGTH:Number = 1000;				// 1 TO 1000
			public const PERSPECTIVEPROJECTIONX:Number = 250;	// -1000 TO 1000
			public const PERSPECTIVEPROJECTIONY:Number = 124;	// -1000 TO 1000
			
			[Bindable]
			public var fileList:ArrayList = MarkerManager.getInstance().getVideoList(); // FIXME : this is dirty, should be dynamic
			
			/** init coverflow component 
			 **/ 
			/* 			public function init (): void
			{
			for (var i:int = 0; i < 5; i++) 
			{
			var itemFolder:ItemCoverFlow = new ItemCoverFlow(true);
			itemFolder.title = "Folder " + i;
			itemFolder.owner = "Peron " + i;
			
			fileList.addItem(itemFolder);
			}
			for ( i = 0; i < 10; i++) 
			{
			var itemVideo:ItemCoverFlow = new ItemCoverFlow(false,"PXRX47L_3yE");
			itemVideo.title = "Movie " + i;
			itemVideo.time = i * 10;
			itemVideo.owner = "Peron " + i + 10;
			itemVideo.chanel = "chanel" + i;
			fileList.addItem(itemVideo);
			}
			} */
			
			/** Return a Class Factory adapted to the item :
			 *  - Movie
			 * 	- Picture
			 *  - Folder
			 *  - Music */
			private function itemRender(item:VideoInfoVO):ClassFactory 
			{
				var cla:Class = PodRenderer;
				
				if (!item is VideoInfoVO)
					cla = MyFolderRenderer;
				else
					cla = MyMovieRenderer;
				
				return new ClassFactory(cla);
			}
			
			public function onClick():void
			{
				var item:VideoInfoVO = list.selectedItem as VideoInfoVO;
				channel.text = item.channel;
			}
			
			private function getListVideosInChanelFromLiveCycle(channelName:String):ArrayList
			{
				var itemList: ArrayList = new ArrayList();
				
				//FIXME : implement a filter to sort the LiveCycle video list
				
				return itemList;
			}
			
			private function onDisplayButtonDoubleClick(e:MouseEvent):void
			{
				var selected:VideoInfoVO = (list.selectedItem as VideoInfoVO);
				
				if (!list.selectedItem is VideoInfoVO)
				{
					//Get List Chanel and reload list
					fileList = new ArrayList();
					fileList = getListVideosInChanelFromLiveCycle(selected.channel);
				}
				else
				{	// Popup Video
					var win : PopUpPlayer = new PopUpPlayer();
					win.idYoutubeVideo = selected.idYoutubeVideo;
					PopUpManager.addPopUp(win,this,true);
					PopUpManager.centerPopUp(win);
				}
			}
			
		]]>
	</fx:Script>
	
	<s:BitmapImage id="img"
				   source="@Embed('/assets/images/nature2_back.jpg')"
				   fillMode="scale"
				   left="0" right="0"
				   top="0" bottom="0" />
	
	<s:Label y="27" id="channel" color="0x208015" fontSize="25" fontFamily="Cooper Std Black" horizontalCenter="0" />
	
	<s:List id="list" x="0" y="0" width="100%" height="100%" borderVisible="false"
			click="{onClick()}" contentBackgroundAlpha="0.0" dataProvider="{fileList}"
			doubleClick="onDisplayButtonDoubleClick(event)" doubleClickEnabled="true"
			itemRendererFunction="itemRender" selectedIndex="0">
		
		<s:layout>
			<coverflow:CoverflowLayout id="coverflow" 
									   selectedIndex="{ list.selectedIndex }"
									   horizontalDistance="{HORIZONTALDISTANCE}"
									   selectedItemProximity="{SELECTEDITEMPROXIMITY}"
									   depthDistance="{DEPTHDISTANCE}" 
									   elementRotation="{ELEMENTROTATION}" 
									   focalLength="{FOCALLENGTH}"
									   perspectiveProjectionX="{PERSPECTIVEPROJECTIONX}" 
									   perspectiveProjectionY="{PERSPECTIVEPROJECTIONY}"/>
		</s:layout>
	</s:List>
</s:Group>
